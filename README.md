# API Расписания МИЭТ

Этот проект представляет собой API для получения актуального расписания занятий и информации о свободном времени для студентов МИЭТ, используя данные с официального сайта.

## Требования

- Docker
- Docker Compose

## Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_вашего_репозитория>
    cd miet-schedule
    ```

2.  **Создайте файл окружения:**
    Скопируйте `.env.example` в `.env`:
    ```bash
    cp .env.example .env
    ```
    *Убедитесь, что в `.env` переменные `SESSION_DRIVER`, `CACHE_STORE` и `QUEUE_CONNECTION` установлены в `file` или `sync`, так как проект на данный момент не использует базу данных.*

3.  **Сгенерируйте ключ приложения Laravel (если это не было сделано автоматически при создании `.env`):**
    Эта команда выполняется внутри контейнера `app` после его первого запуска.
    ```bash
    docker-compose exec app php artisan key:generate
    ```
    *Примечание: Если вы запускаете проект впервые, ключ может быть уже сгенерирован при установке зависимостей Laravel, если настроен `post-create-project-cmd`.*

4.  **Соберите и запустите Docker-контейнеры:**
    ```bash
    docker-compose up -d --build
    ```
    *   Флаг `--build` нужен при первом запуске или если вы вносили изменения в `Dockerfile`.
    *   Флаг `-d` запускает контейнеры в фоновом (detached) режиме.

5.  **Приложение будет доступно по адресу:**
    [http://localhost:8000](http://localhost:8000) (если в `docker-compose.yml` порт `8000:80` для nginx).

## Описание API эндпоинтов

### 1. Получение информации о текущей учебной неделе

-   **Метод:** `GET`
-   **URL:** `/current-week`
-   **Описание:** Возвращает тип текущей учебной недели (например, "1 числитель").
-   **Параметры запроса:** Нет.
-   **Пример успешного ответа (200 OK):**
    ```json
    {
        "type_name": "1 числитель"
    }
    ```
-   **Возможные ошибки:**
    -   `500 Internal Server Error` (или другой статус): Если не удалось определить неделю (например, семестр не начался).
        ```json
        {
            "message": "Не удалось определить текущую неделю. Возможно, семестр еще не начался или произошла ошибка."
        }
        ```

### 2. Получение расписания занятий для группы

-   **Метод:** `GET`
-   **URL:** `/schedule/{groupName}`
-   **Описание:** Возвращает расписание занятий для указанной группы на все типы недель.
-   **Параметры URL:**
    -   `groupName` (string, required): Название группы (например, "ЭКТ-11").
-   **Пример успешного ответа (200 OK):**
    ```json
    {
        "Понедельник": {
            "1 числитель": [
                {
                    "time_from": "09:00",
                    "time_to": "10:30",
                    "subject": "Математика"
                },
                // ... другие пары
            ],
            "1 знаменатель": [
                // ... пары для знаменателя
            ]
        },
        "Вторник": {
            // ...
        }
        // ... и так далее для других дней
    }
    ```
-   **Возможные ошибки:**
    -   `404 Not Found`: Если расписание для указанной группы не найдено.
        ```json
        {
            "message": "Расписание не найдено для группы ЭКТ-11"
        }
        ```

### 3. Получение свободного времени для группы

-   **Метод:** `GET`
-   **URL:** `/free-time/{groupName}`
-   **Описание:** Рассчитывает и возвращает свободные временные слоты для указанной группы на все типы недель.
-   **Параметры URL:**
    -   `groupName` (string, required): Название группы.
-   **Пример успешного ответа (200 OK):**
    ```json
    {
        "Понедельник": {
            "1 числитель": [
                { "from": "08:00", "to": "09:00" },
                { "from": "10:30", "to": "12:00" },
                // ... другие свободные слоты
                { "from": "15:00", "to": "20:00" }
            ],
            "1 знаменатель": [
                // ... свободные слоты для знаменателя
            ]
        },
        "Вторник": {
            // ...
        }
        // ... и так далее для других дней
    }
    ```
-   **Возможные ошибки:**
    -   `404 Not Found`: Если расписание для группы не найдено (и, следовательно, свободное время рассчитать невозможно).
        ```json
        {
            "message": "Расписание не найдено для группы ЭКТ-11, невозможно рассчитать свободное время."
        }
        ```

## Запуск тестов

Для запуска всех тестов (Unit):
```bash
php artisan test
```

## Инструменты для качества кода
В проекте настроены следующие инструменты для поддержания качества кода:

Статический анализ кода (PHPStan):
Для проверки кода на потенциальные ошибки без его выполнения.
```bash
composer analyse
```
Проверка стиля кода (PHP_CodeSniffer):
Для проверки соответствия кода стандарту PSR-12.
```bash
composer cs-check
```
Автоматическое форматирование кода (PHP-CS-Fixer):
Посмотреть предлагаемые изменения (без реального исправления файлов):
```bash
composer format-check
```
Применить автоматическое форматирование к файлам проекта:
```bash
composer format-apply
```


## Git Hooks
В проекте настроен pre-commit хук. Перед каждым коммитом автоматически запускаются:

PHPStan (composer analyse)
PHP_CodeSniffer (composer cs-check)
PHPUnit тесты (composer test)

Если какая-либо из этих проверок не проходит, коммит будет отменен до тех пор, пока ошибки не будут исправлены. Это помогает поддерживать высокое качество кода в репозитории.